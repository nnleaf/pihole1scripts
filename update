#!/bin/bash
#     ////     //  ////     //
#    // //    //  // //    //
#   //  //   //  //  //   //
#  //   //  //  //   //  //
# //    // //  //    // //
#//     ////  //     ////
#
# 20181117 - First script for updating PiHole VM
# 20200319 - Added testing disk access speed
# 20200317 - Added pihole updates
#            (1)https://www.debian.org/doc/manuals/debian-reference/ch09.en.html
# 20200331 - Combined update and log scripts together

echo "------------------------------------------------------------------------"
echo "Updating Debian..."
echo "------------------------------------------------------------------------"
sudo apt-get update
echo "------------------------------------------------------------------------"
echo "Upgrading Debian..."
echo "------------------------------------------------------------------------"
sudo apt-get upgrade
echo "------------------------------------------------------------------------"
echo "Running autoclean..."
echo "------------------------------------------------------------------------"
sudo apt-get autoclean
echo "------------------------------------------------------------------------"
echo "Updating mlocate..."
echo "------------------------------------------------------------------------"
sudo updatedb
echo "------------------------------------------------------------------------"
echo "Updating PiHole..."
echo "------------------------------------------------------------------------"
sudo pihole -up
echo "------------------------------------------------------------------------"
echo "Updating PiHole - Speedtest..."
echo "------------------------------------------------------------------------"
sudo curl -sSL https://github.com/arevindh/pihole-speedtest/raw/master/update.sh | bash
echo "------------------------------------------------------------------------"
echo "Remember to check logs!"
echo "------------------------------------------------------------------------"
read -p "Check logs? (y/n)"
echo
if [[ $REPLY =~ ^[Yy]$ ]]
then
  echo "------------------------------------------------------------------------"
  echo "Checking Unattended Updates log..."
  echo "------------------------------------------------------------------------"
  sudo tail -n 5 /var/log/dpkg.log
  echo "------------------------------------------------------------------------"
  echo "Checking if fail2ban is running..."
  echo "------------------------------------------------------------------------"
  sudo fail2ban-client status
  echo "------------------------------------------------------------------------"
  echo "Checking ufw status..."
  echo "------------------------------------------------------------------------"
  sudo ufw status
  #20200319 - (1)
  echo "------------------------------------------------------------------------"
  echo "Testing disk access speed..."
  echo "------------------------------------------------------------------------"
  sudo hdparm -tT /dev/sda1
  echo "------------------------------------------------------------------------"
  read -p "Run rkhunter scan? (y/n)"
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]
  then
  echo "------------------------------------------------------------------------"
  echo "Running rkhunter scan..."
  echo "------------------------------------------------------------------------"
  sudo rkhunter --check --rwo
  fi
fi
